<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Ceylon Grocery</title>
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
<main>
    <!--Header-->
    <header>
        <nav class="navbar navbar-expand-lg bg-dark" >
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="../assets/images/icon.png" alt="icon" width="50" height="50">
                </a>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item ">
                            <a class="nav-link active text-white"  aria-current="page" href="../index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/customer.html">Customer</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/item.html">Item</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/order.html">Order</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/other.html">Others</a>
                        </li>
                    </ul>
                </div>
            </div>

            <nav class="navbar bg-dark">
                <div class="container">
                    <a class="navbar-brand" href="../pages/signIn.html">
                        <img alt="Bootstrap" height="40" src="../assets/images/signin.png" width="40">
                    </a>
                </div>
            </nav>

        </nav>

    </header>
    <br>
    <!--Headline-->
    <div>
        <h1 class="container-fluid"><span class="headline_part1">Manage</span> <span
                class="headline_part2">Customer</span></h1>
    </div>

    <section class="container-fluid mt-3" id="customerContent">
        <!--Start customer data form -->
        <section class="container-fluid mt-5">

            <!-- First Row-->
            <div class="row">
                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerID">Customer ID</label>
                    <input class="form-control customer_form" id="txtCustomerID" placeholder="C001" type="text">
                </div>

                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerName">Customer Name</label>
                    <input class="form-control customer_form" id="txtCustomerName" placeholder="Lasari Imalsha"
                           type="text">
                </div>
            </div>

            <!-- Second Row-->
            <div class="row">

                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerAddress">Customer Address</label>
                    <input class="form-control customer_form" id="txtCustomerAddress"
                           placeholder="Galle" type="text">
                </div>

                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerSalary">Customer Salary</label>
                    <input class="form-control customer_form" id="txtCustomerSalary" placeholder="100000" type="number">
                </div>
            </div>
        </section>
        <!--End customer data form -->


        <!-- Buttons Section -->
        <section class="container-fluid mt-1 button mb-5">
            <button class="btn btn-primary" id="btnSaveCustomer" type="button">Save Customer</button>
            <button class="btn btn-warning" id="btnUpdateCustomer" type="button">Update Customer</button>
            <button class="btn btn-danger" id="btnDeleteCustomer" type="button">Delete Customer</button>
            <button class="btn btn-success" id="btnClearCustomer" type="button">Clear Fields</button>
        </section>

        <!-- Search Bar -->
        <section class="row mb-3">
            <form class="d-flex col-5" role="search">
                <input aria-label="Search" class="form-control me-2 " id="myInput" placeholder="CustomerID/NIC/Name"
                       type="search">
                <!--                <button class="btn btn-outline-success" type="submit">Search</button>-->
            </form>
        </section>


        <!--  Customer Table -->
        <section class="row ">

            <div class="container-fluid">
                <table class="table table-bordered table-hover">
                    <thead class="bg-info text-white">
                    <tr class="table-info">
                        <td>Customer Id</td>
                        <td>Name</td>
                        <td>Address</td>
                        <td>Salary</td>
                    </tr>
                    </thead>

                    <tbody id="tblCustomer">

                    </tbody>
                </table>
            </div>
        </section>

    </section>
</main>

<!--Import js for bootstrap-->
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery-3.6.1.min.js"></script>

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>

    $('#txtCustomerID').focus();

    let customers = [];

    //Save Customer
    $('#btnSaveCustomer').click(function () {

        let customerID = $('#txtCustomerID').val();
        let customerName = $('#txtCustomerName').val();
        let customerAddress = $('#txtCustomerAddress').val();
        let customerSalary = $('#txtCustomerSalary').val();

        var customerObject = {
            id: customerID,
            name: customerName,
            address: customerAddress,
            salary: customerSalary
        }

        //add the customer object to the array
        customers.push(customerObject);

        loadAllCustomers();

        clearCustomerTextField();

        bindRowClickEvents();

        $('#txtCustomerID').focus();

    });

    //function for add data to table
    function loadAllCustomers() {
        $('#tblCustomer').empty();

        for (var customer of customers) {
            var row = `<tr><td>${customer.id}</td><td>${customer.name}</td><td>${customer.address}</td><td>${customer.salary}</td></tr>`;

            //then add it to the table body of customer table
            $('#tblCustomer').append(row);
        }

        saveCustomerAlert();
    }

    //Btn Delete Customer
    $("#btnDeleteCustomer").click(function () {
        let deleteCustomerID = $('#txtCustomerID').val();
        if (deleteCustomer(deleteCustomerID)) {
            deleteCustomerAlert();
            clearCustomerTextField();
            $('#txtCustomerID').focus();
        } else {
            deleteErrorCustomerAlert();
            $('#txtCustomerID').focus();
        }


    });

    //Btn Update Customer
    $("#btnUpdateCustomer").click(function () {
        let customerID = $("#txtCustomerID").val();
        let response = updateCustomer(customerID);
        if (response) {
            updateCustomerAlert();
            clearCustomerTextField();
        } else {
            updateErrorCustomerAlert();
        }
    });


    //Customer Search Bar
    $('#myInput').on('keyup', function () {
        var value = $(this).val().toLowerCase();
        $('#tblCustomer>tr').filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    });


    //btn Clear Text Field Data
    $('#btnClearCustomer').click(function () {
        clearCustomerTextField();
        $('#txtCustomerID').focus();
    });

    //Save Alert
    function saveCustomerAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Customer saved',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //update Alert
    function updateCustomerAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Customer Updated',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //update error Alert
    function updateErrorCustomerAlert() {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Something went wrong!',
        })
    }

    //delete alert
    function deleteCustomerAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Customer Deleted',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //delete error Alert
    function deleteErrorCustomerAlert() {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Something went wrong!',
        })
    }


    //when click table row data auto fill into text fields
    function bindRowClickEvents() {
        $('#tblCustomer>tr').click(function () {
            let id = $(this).children(':eq(0)').text();
            let name = $(this).children(':eq(1)').text();
            let address = $(this).children(':eq(2)').text();
            let salary = $(this).children(':eq(3)').text();

            $('#txtCustomerID').val(id);
            $('#txtCustomerName').val(name);
            $('#txtCustomerAddress').val(address);
            $('#txtCustomerSalary').val(salary);
        });
    }


    $('#txtCustomerID').on('keydown', function (event) {
        if (event.which == 13) {
            let cusId = $('#txtCustomerID').val();
            let customer = searchCustomer(cusId);
            if (customer != null) {
                setCustomerTextFieldValue(customer.id, customer.name, customer.address, customer.salary);
            } else {
                alert("There is no customer available For That " + cusId);
                $('#txtCustomerName').val('');
                $('#txtCustomerAddress').val('');
                $('#txtCustomerSalary').val('');
            }

        }
    });


    //Search customer function
    function searchCustomer(cusID) {
        for (let customer of customers) {
            if (customer.id == cusID) {
                return customer;
            }
        }
        return null;
    }


    function setCustomerTextFieldValue(id, name, address, salary) {
        $('#txtCustomerID').val(id);
        $('#txtCustomerName').val(name);
        $('#txtCustomerAddress').val(address);
        $('#txtCustomerSalary').val(salary);
    }

    //Clear text field Function
    function clearCustomerTextField() {
        $('#txtCustomerID').val('');
        $('#txtCustomerName').val('');
        $('#txtCustomerAddress').val('');
        $('#txtCustomerSalary').val('');
    }


    //Delete customer function
    function deleteCustomer(customerID) {
        let customer = searchCustomer(customerID);
        if (customer != null) {
            let customerIndexNumber = customers.indexOf(customer);
            customers.splice(customerIndexNumber, 1);
            loadAllCustomers();
            return true;
        } else {
            return false;
        }
    }

    //update Customer function
    function updateCustomer(customerID) {
        let customer = searchCustomer(customerID);
        if (customer != null) {
            customer.id = $('#txtCustomerID').val();
            customer.name = $('#txtCustomerName').val();
            customer.address = $('#txtCustomerAddress').val();
            customer.salary = $('#txtCustomerSalary').val();
            loadAllCustomers();
            return true;
        } else {
            return false;
        }
    }

    //Validation
    // customer regular expressions
    const cusIDRegEx = /^(C)[0-9]{3}$/;
    const cusNameRegEx = /^[A-z ]{5,20}$/;
    const cusAddressRegEx = /^[0-9/A-z. ,]{7,}$/;
    const cusSalaryRegEx = /^[0-9]{1,}[.]?[0-9]{1,2}$/;

    let customerValidations = [];

    customerValidations.push({
        reg: cusIDRegEx,
        field: $('#txtCustomerID'),
        error: 'Customer ID Pattern is Wrong : C00-001'
    });
    customerValidations.push({
        reg: cusNameRegEx,
        field: $('#txtCustomerName'),
        error: 'Customer Name Pattern is Wrong : A-z 5-20'
    });
    customerValidations.push({
        reg: cusAddressRegEx,
        field: $('#txtCustomerAddress'),
        error: 'Customer Address Pattern is Wrong : A-z 0-9 ,/'
    });
    customerValidations.push({
        reg: cusSalaryRegEx,
        field: $('#txtCustomerSalary'),
        error: 'Customer Salary Pattern is Wrong : 100 or 100.00'
    });

    //disable tab key of all four text fields using grouping selector in CSS
    $("#txtCustomerID,#txtCustomerName,#txtCustomerAddress,#txtCustomerSalary").on('keydown', function (event) {
        if (event.key == "Tab") {
            event.preventDefault();
        }
    });

    $("#txtCustomerID,#txtCustomerName,#txtCustomerAddress,#txtCustomerSalary").on('keyup', function (event) {
        checkValidity();
    });

    $("#txtCustomerID,#txtCustomerName,#txtCustomerAddress,#txtCustomerSalary").on('blur', function (event) {
        checkValidity();
    });

    $("#txtCustomerID").on('keydown', function (event) {
        if (event.key == "Enter" && check(cusIDRegEx, $("#txtCustomerID"))) {
            $("#txtCustomerName").focus();
        } else {
            focusText($("#txtCustomerID"));
        }
    });


    $("#txtCustomerName").on('keydown', function (event) {
        if (event.key == "Enter" && check(cusNameRegEx, $("#txtCustomerName"))) {
            $("#txtCustomerAddress").focus();
        }
    });


    $("#txtCustomerAddress").on('keydown', function (event) {
        if (event.key == "Enter" && check(cusAddressRegEx, $("#txtCustomerAddress"))) {
            $("#txtCustomerSalary").focus();
        }
    });


    $("#txtCustomerSalary").on('keydown', function (event) {
        if (event.key == "Enter" && check(cusSalaryRegEx, $("#txtCustomerSalary"))) {
            let res = confirm("Do you want to add this customer.?");
            if (res) {
                $('#btnSaveCustomer').click();
            }
        }
    });

    function checkValidity() {
        let errorCount = 0;
        for (let validation of customerValidations) {
            if (validation.reg.test(validation.field.val())) {
                textSuccess(validation.field, "");
            } else {
                errorCount = errorCount + 1;
                setTextError(validation.field, validation.error);
            }
        }
        setButtonState(errorCount);
    }

    function check(regex, txtField) {
        let inputValue = txtField.val();
        return regex.test(inputValue) ? true : false;
    }

    function setTextError(txtField, error) {
        if (txtField.val().length <= 0) {
            defaultText(txtField, "");
        } else {
            txtField.css('border', '2px solid red');
            txtField.parent().children('span').text(error);
        }

    }

    function textSuccess(txtField, error) {
        if (txtField.val().length <= 0) {
            defaultText(txtField, "");
        } else {
            txtField.css('border', '2px solid green');
            txtField.parent().children('span').text(error);
        }
    }

    function defaultText(txtField, error) {
        txtField.css("border", "1px solid #ced4da");
        txtField.parent().children('span').text(error);
    }

    function focusText(txtField) {
        txtField.focus();
    }

    function setButtonState(value) {
        if (value > 0) {
            $("#btnCustomer").attr('disabled', true);
        } else {
            $("#btnCustomer").attr('disabled', false);
        }
    }



</script>
</body>
</html>