<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Ceylon Grocery</title>
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
<main>
    <!--Header-->
    <header>
        <nav class="navbar navbar-expand-lg bg-dark" >
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="../assets/images/icon.png" alt="icon" width="50" height="50">
                </a>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item ">
                            <a class="nav-link active text-white"  aria-current="page" href="../index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/customer.html">Customer</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/item.html">Item</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/order.html">Order</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="../pages/other.html">Others</a>
                        </li>
                    </ul>
                </div>
            </div>

            <nav class="navbar bg-dark">
                <div class="container">
                    <a class="navbar-brand" href="../pages/signIn.html">
                        <img alt="Bootstrap" height="40" src="../assets/images/signin.png" width="40">
                    </a>
                </div>
            </nav>

        </nav>

    </header>
    <br>
    <!--Headline-->
    <div>
        <h1 class="container-fluid"><span class="headline_part1">Manage</span> <span
                class="headline_part2">Customer</span></h1>
    </div>

    <section class="container-fluid mt-3" id="customerContent">
        <!--Start customer data form -->
        <section class="container-fluid mt-5">

            <!-- First Row-->
            <div class="row">
                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerID">Customer ID</label>
                    <input class="form-control customer_form" id="txtCustomerID" placeholder="C001" type="text">
                </div>

                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerName">Customer Name</label>
                    <input class="form-control customer_form" id="txtCustomerName" placeholder="Lasari Imalsha"
                           type="text">
                </div>
            </div>

            <!-- Second Row-->
            <div class="row">

                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerAddress">Customer Address</label>
                    <input class="form-control customer_form" id="txtCustomerAddress"
                           placeholder="Galle" type="text">
                </div>

                <div class="mb-3 col">
                    <label class="form-label" for="txtCustomerSalary">Customer Salary</label>
                    <input class="form-control customer_form" id="txtCustomerSalary" placeholder="100000" type="number">
                </div>
            </div>
        </section>
        <!--End customer data form -->


        <!-- Buttons Section -->
        <section class="container-fluid mt-1 button mb-5">
            <button class="btn btn-primary" id="btnSaveCustomer" type="button">Save Customer</button>
            <button class="btn btn-warning" id="btnUpdateCustomer" type="button">Update Customer</button>
            <button class="btn btn-danger" id="btnDeleteCustomer" type="button">Delete Customer</button>
            <button class="btn btn-success" id="btnClearCustomer" type="button">Clear Fields</button>
        </section>

        <!-- Search Bar -->
        <section class="row mb-3">
            <form class="d-flex col-5" role="search">
                <input aria-label="Search" class="form-control me-2 " id="myInput" placeholder="CustomerID/NIC/Name"
                       type="search">
                <!--                <button class="btn btn-outline-success" type="submit">Search</button>-->
            </form>
        </section>


        <!--  Customer Table -->
        <section class="row ">

            <div class="container-fluid">
                <table class="table table-bordered table-hover">
                    <thead class="bg-info text-white">
                    <tr class="table-info">
                        <td>Customer Id</td>
                        <td>Name</td>
                        <td>Address</td>
                        <td>Salary</td>
                    </tr>
                    </thead>

                    <tbody id="tblCustomer">

                    </tbody>
                </table>
            </div>
        </section>

    </section>
</main>

<!--Import js for bootstrap-->
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery-3.6.1.min.js"></script>

<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $('#txtCustomerID').focus();

    let customers = [];

    //Save Customer
    $('#btnSaveCustomer').click(function () {

        let customerID = $('#txtCustomerID').val();
        let customerName = $('#txtCustomerName').val();
        let customerAddress = $('#txtCustomerAddress').val();
        let customerSalary = $('#txtCustomerSalary').val();

        var customerObject = {
            id: customerID,
            name: customerName,
            address: customerAddress,
            salary: customerSalary
        }

        //add the customer object to the array
        customers.push(customerObject);

        loadAllCustomers();

        textFieldDataCLear();

        bindRowClickEvents();

        $('#txtCustomerID').focus();
    });

    //function for add data to table
    function loadAllCustomers() {
        $('#tblCustomer').empty();

        for(var customer of customers){
            var row = `<tr><td>${customer.id}</td><td>${customer.name}</td><td>${customer.address}</td><td>${customer.salary}</td></tr>`;

            //then add it to the table body of customer table
            $('#tblCustomer').append(row);
        }

        saveAlert();
    }

    //Btn Delete Customer
    $("#btnDeleteCustomer").click(function () {
        let deleteCustomerID = $('#txtCustomerID').val();
        if (deleteCustomer(deleteCustomerID)) {
            deleteCustomerAlert();
            clearCustomerTextField();
            $('#txtCustomerID').focus();
        } else {
            deleteErrorCustomerAlert();
            $('#txtCustomerID').focus();
        }

    });
    //when click table row data auto fill into text fields
    function bindRowClickEvents(){
        $('#tblCustomer>tr').click(function (){
            let id = $(this).children(':eq(0)').text();
            let name = $(this).children(':eq(1)').text();
            let address = $(this).children(':eq(2)').text();
            let salary = $(this).children(':eq(3)').text();

            $('#txtCustomerID').val(id);
            $('#txtCustomerName').val(name);
            $('#txtCustomerAddress').val(address);
            $('#txtCustomerSalary').val(salary);
        });
    }

    //btn clear data
    $('#btnClearCustomer').click(function (){
        textFieldDataCLear();
    });

    //clear data function
    function textFieldDataCLear(){
        $('#txtCustomerID').val('');
        $('#txtCustomerName').val('');
        $('#txtCustomerAddress').val('');
        $('#txtCustomerSalary').val('');

        $('#txtCustomerID').focus();
    }

    //Save Alert
    function saveAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Your work has been saved',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //delete alert
    function deleteCustomerAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Customer Deleted',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //delete error Alert
    function deleteErrorCustomerAlert() {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Something went wrong!',
        })
    }

    //focus
    $('#txtCustomerID').on('keydown',function (event){
        if(event.which == 13){
            $('#txtCustomerName').focus();
        }
    });

    $('#txtCustomerName').on('keydown',function (event){
        if(event.which == 13){
            $('#txtCustomerAddress').focus();
        }
    });


    $('#txtCustomerAddress').on('keydown',function (event){
        if(event.which == 13){
            $('#txtCustomerSalary').focus();
        }
    });


    //added Item Search
    $('#myInput').on('keyup', function () {
        var value = $(this).val().toLowerCase();
        $('#tblCustomer>tr').filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    });


</script>
</body>
</html>