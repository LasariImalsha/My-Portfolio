<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Item</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Ceylon Grocery</title>
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
<main>
<!--Start Header-->
<header>
    <nav class="navbar navbar-expand-lg bg-dark" >
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="../assets/images/icon.png" alt="icon" width="50" height="50">
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item ">
                        <a class="nav-link active text-white"  aria-current="page" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="../pages/customer.html">Customer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="../pages/item.html">Item</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="../pages/order.html">Order</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="../pages/other.html">Others</a>
                    </li>
                </ul>
            </div>
        </div>

        <nav class="navbar bg-dark">
            <div class="container">
                <a class="navbar-brand" href="../pages/signIn.html">
                    <img alt="Bootstrap" height="40" src="../assets/images/signin.png" width="40">
                </a>
            </div>
        </nav>

    </nav>
</header>
<br>
<!--Page Heading-->
    <div>
        <h1 class="container-fluid"><span class="headline_part1">Manage</span> <span
                class="headline_part2">Item</span></h1>
    </div>

    <section class="container-fluid mt-3" id="customerContent">
        <!--Start Item data form -->
        <section class="container-fluid mt-5">

            <!-- First Row-->
            <div class="row">
                <div class="mb-3 col">
                    <label class="form-label" for="txtItemCode">Item Code</label>
                    <input class="form-control customer_form" id="txtItemCode" placeholder="I001" type="text">
                </div>

                <div class="mb-3 col">
                    <label class="form-label" for="txtItemName">Item Name</label>
                    <input class="form-control customer_form" id="txtItemName" placeholder="Biscuits"
                           type="text">
                </div>
            </div>

            <!-- Second Row-->
            <div class="row">

                <div class="mb-3 col">
                    <label class="form-label" for="txtItemQTYOnHand">QTY On Hand</label>
                    <input class="form-control customer_form" id="txtItemQTYOnHand"
                           placeholder="2" type="number">
                </div>

                <div class="mb-3 col">
                    <label class="form-label" for="txtItemPrice">Price</label>
                    <input class="form-control customer_form" id="txtItemPrice" placeholder="300" type="number">
                </div>
            </div>
        </section>
        <!--End Item data form -->


        <!-- Buttons Section -->
        <section class="container-fluid mt-1 button mb-5">
            <button class="btn btn-primary" id="btnSaveItem" type="button">Save Item</button>
            <button class="btn btn-warning" id="btnItemUpdate" type="button">Update Item</button>
            <button class="btn btn-danger" id="btnItemDelete" type="button">Delete Item</button>
            <button class="btn btn-success" id="btnClearItem" type="button">Clear Fields</button>
        </section>

        <!-- Search Bar -->
        <section class="row mb-3">
            <form class="d-flex col-5" role="search">
                <input aria-label="Search" class="form-control me-2 " id="myInput" placeholder="ItemCode/Name"
                       type="search">
                <!--                <button class="btn btn-outline-success" type="submit">Search</button>-->
            </form>

        </section>


        <!--  Customer Table -->
        <section class="row ">

            <div class="container-fluid">
                <table class="table table-bordered table-hover">
                    <thead class="bg-info text-white">
                    <tr class="table-info">
                        <td>Item Code</td>
                        <td>Name</td>
                        <td>Qty On Hand</td>
                        <td>Price</td>
                    </tr>
                    </thead>

                    <tbody id="tblItem">

                    </tbody>
                </table>
            </div>
        </section>

    </section>
    <!-- End Item Here-->

</main>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery-3.6.1.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $('#txtItemCode').focus();

    let items = [];

    //Save Item
    $('#btnSaveItem').click(function () {
        let itemCode = $('#txtItemCode').val();
        let itemName = $('#txtItemName').val();
        let itemQtyOnHand = $('#txtItemQTYOnHand').val();
        let itemPrice = $('#txtItemPrice').val();


        var itemObject = {
            code: itemCode,
            name: itemName,
            qtyonhand: itemQtyOnHand,
            price: itemPrice

        }

        //add the item object to the array
        items.push(itemObject);


        loadAllItems();

        bindRowClickEvents();

        clearItemTextField();

        $('#txtItemCode').focus();
    });

    //function for add data to table
    function loadAllItems() {
        $('#tblItem').empty();

        for (item of items) {
            var row = `<tr><td>${item.code}</td><td>${item.name}</td><td>${item.qtyonhand}</td><td>${item.price}</td></tr>`

            //then add it to the table body of item table
            $('#tblItem').append(row);
        }

        saveItemAlert();
    }

    //Btn Delete Item
    $("#btnItemDelete").click(function () {
        let deleteItemID = $("#txtItemCode").val();
        if (deleteItem(deleteItemID)) {
            clearItemTextField();
            deleteCustomerAlert();
            $('#txtItemCode').focus();
        } else {
            deleteErrorCustomerAlert();
            $('#txtItemCode').focus();
        }

    });


    //Btn Update Item
    $("#btnItemUpdate").click(function () {
        let itemID = $("#txtItemCode").val();
        let response = updateItem(itemID);
        if(response){
            updateItemAlert();
            clearItemTextField();
        }else {
            updateErrorItemAlert();
        }
    });


    //Item Search Bar
    $('#myInput').on('keyup', function () {
        var value = $(this).val().toLowerCase();
        $('#tblItem>tr').filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    });


    //btn Clear Text Field Data
    $('#btnClearItem').on(function () {
        clearItemTextField();
    });


    //Save Alert
    function saveItemAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Item saved',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //update Alert
    function updateItemAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Item Updated',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //error Alert
    function updateErrorItemAlert(){
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Something went wrong!',
        })
    }

    //delete alert
    function deleteCustomerAlert() {
        Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Item Deleted',
            showConfirmButton: false,
            timer: 1500
        })
    }

    //delete error Alert
    function deleteErrorCustomerAlert() {
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Something went wrong!',
        })
    }


    //when click table row data auto fill into text fields
    function bindRowClickEvents() {
        $('#tblItem>tr').click(function () {
            let code = $(this).children(':eq(0)').text();
            let name = $(this).children(':eq(1)').text();
            let qtyonhand = $(this).children(':eq(2)').text();
            let price = $(this).children(':eq(3)').text();

            $('#txtItemCode').val(code);
            $('#txtItemName').val(name);
            $('#txtItemQTYOnHand').val(qtyonhand);
            $('#txtItemPrice').val(price);

        });
    }


    $("#txtItemCode").on('keydown', function (event) {
        if (event.which == 13) {
            let itemId = $("#txtItemCode").val();
            let item = searchItem(itemId);
            if (item != null) {
                setItemTextFieldValues(item.code, item.name, item.qtyonhand, item.price);
            } else {
                alert("There is no item available For That" + itemId);
                $('#txtItemName').val('');
                $('#txtItemQTYOnHand').val('');
                $('#txtItemPrice').val('');
            }
        }
    });

    //Search Item function
    function searchItem(itemCode) {
        for (let item of items) {
            if (item.code == itemCode) {
                return item;
            }
        }
        return null;
    }

    function setItemTextFieldValues(code, name, qtyonhand, price) {
        $('#txtItemCode').val(code);
        $('#txtItemName').val(name);
        $('#txtItemQTYOnHand').val(qtyonhand);
        $('#txtItemPrice').val(price);
    }

    //Clear text field Function
    function clearItemTextField() {
        $('#txtItemCode').val('');
        $('#txtItemName').val('');
        $('#txtItemQTYOnHand').val('');
        $('#txtItemPrice').val('');
    }


    //Delete item function
    function deleteItem(itemCode) {
        let item = searchItem(itemCode);
        if (item != null) {
            let itemIndexNumber = items.indexOf(item);
            items.splice(itemIndexNumber, 1);
            loadAllItems();
            return true;
        } else {
            return false;
        }

    }

    //update Item function
    function updateItem(itemCode) {
        let item = searchItem(itemCode);
        if(item!= null){
            item.code = $("#txtItemCode").val();
            item.name = $("#txtItemName").val();
            item.qtyonhand = $("#txtItemQTYOnHand").val();
            item.price = $("#txtItemPrice").val();
            loadAllItems();
            return true;
        }else {
            return false;
        }
    }

</script>
</body>
</html>